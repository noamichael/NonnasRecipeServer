@if (loggedIn && canWriteRecipes) {
  <nr-page-action label="Add" icon="pi pi-plus" desktop="topbar" mobile="topbar" (click)="openRecipe()"
    color="success">
  </nr-page-action>
}
<nr-page-action label="Clear Filters" icon="pi pi-times" desktop="topbar" mobile="hidden" (click)="clearFilters(dv)"
  color="primary">
</nr-page-action>
<nr-page-action icon="pi pi-filter" color="primary" desktop="hidden" mobile="topbar"
  (click)="showFilters = !showFilters">
</nr-page-action>

<ng-template #pageFilters let-id="id">
  <div class="table-filters">
    <div>
      <label class="label" for="recipeName">Recipe Name</label>
      <input type="text" id="recipeName" class="table-filter" [(ngModel)]="filters.recipeName"
        (ngModelChange)="onFilterChange('recipeName', dv)" placeholder="Recipe Name" pInputText>
    </div>
    <div>
      <span class="label">Recipe Type</span>
      <p-dropdown inputId="recipeTypeFilter_{{id}}" appendTo="body" [options]="recipeTypes" [(ngModel)]="filters.recipeType"
        (ngModelChange)="onFilterChange('recipeType', dv)" name="recipeType" [style]="{width: '100%'}"
        optionLabel="label" [required]="true">
      </p-dropdown>
    </div>
    <div>
      <span class="label">Author</span>
      <p-dropdown appendTo="body" inputId="author_{{id}}" [options]="recipeOwners" [(ngModel)]="filters.userId" (ngModelChange)="onFilterChange('userId', dv)"
        name="userId" [style]="{width: '100%'}" optionLabel="label" [required]="true">
      </p-dropdown>
    </div>
    <div>
      <span class="label">WW</span>
      <p-inputSwitch name="ww" [(ngModel)]="filters.weightWatchers"
        (ngModelChange)="onFilterChange('weightWatchers', dv)" inputId="ww_{{id}}">
      </p-inputSwitch>
    </div>
  </div>
</ng-template>

<div class="mobile-search-box">
  <div class="p-inputgroup">
    <input type="text" id="recipeNameMobile" class="table-filter" [(ngModel)]="filters.recipeName"
      (ngModelChange)="onFilterChange('recipeName', dv)" placeholder="Recipe Name" pInputText>
    <button type="button" pButton pRipple icon="pi pi-times" (click)="clearFilters(dv)"
      class="p-button-danger"></button>
  </div>
</div>

<p-dataView #dv (onLazyLoad)="onLazyLoad($event)" [value]="recipes.data" [lazy]="true" [paginator]="true"
  [showPageLinks]="!mobile" [rows]="recipes.count" dataKey="id" [totalRecords]="recipes.totalRecordCount"
  paginatorPosition="bottom">
  <ng-template pTemplate="header">
    <ng-container *ngTemplateOutlet="pageFilters; context: {id: 'list'}"></ng-container>
  </ng-template>
  <ng-template let-recipes pTemplate="list">
    @for (recipe of recipes; track $index) {
      <p-card class="recipe-card" [header]="recipe.recipeName" (click)="onRowSelect(recipe)">
        <div class="recipe-fields">
          <div class="recipe-field">
            <div>Type:&nbsp;</div>
            <div><b>{{recipe.recipeType}}</b></div>
          </div>
          <div class="recipe-field">
            <div>Cook Time:&nbsp;</div>
            <div><b>{{recipe.cookTime || 'N/A'}}</b></div>
          </div>
          <div class="recipe-field">
            <div>Serving:&nbsp;</div>
            <div><b>{{recipe.servingSize || 'N/A'}}</b></div>
          </div>
          <div class="recipe-field">
            <div>WW:&nbsp;</div>
            <div><b>{{recipe.weightWatchers ? 'Yes' : 'No'}}</b></div>
          </div>
          <div class="recipe-field">
            <div>Pts.:&nbsp;</div>
            <div><b>{{recipe.points || 'N/A'}}</b></div>
          </div>
        </div>
      </p-card>
    }
  </ng-template>
</p-dataView>

<p-dialog header="Filter Recipes" [(visible)]="showFilters" [style]="{width: '95%'}">
  <ng-container *ngTemplateOutlet="pageFilters; context: {id: 'modal'}"></ng-container>
  <ng-template pTemplate="footer">
    <button pButton type="button" label="Clear Filters" icon="pi pi-times" (click)="clearFilters(dv)"
      class="p-button-danger">
    </button>
    <button pButton type="button" label="Done" icon="pi pi-check" (click)="showFilters = false">
    </button>
  </ng-template>
</p-dialog>